---
title: 定时器
date: 2025-09-16
tags: ["javascript", "定时器"]
excerpt: "定时器相关内容"
---

## 定时器

JavaScript提供定时执行代码的功能，叫做定时器（timer），主要由`setTimeout()`和`setInterval()`这两个函数来完成。它们向任务队列添加定时任务。

### `setTimeout()`

`setTimeout()`函数用来指定某个函数或某段代码在多少毫秒之后执行。它返回一个整数，表示定时器的编号，以后可以用来取消这个定时器。

```javascript
let timerId = setTimeout(func|code, delay)
```

`setTimeout()`函数接受两个参数，第一个参数`func|code`是将要推迟执行的函数名或者一段代码，第二个参数`delay`是推迟执行的毫秒数。

对于下面的代码

```javascript
setTimeout(function () {
    console.log("大家好")
}, 3000)
```

代码运行3000ms后才会在控制台输出

```console
大家好
```

>**温馨提示**
>
>还有一个需要注意的地方，如果回调函数是对象的方法，那么`setTimeout()`使得方法内部的`this`关键字指向全局环境，而不是定义时所在的那个对象。

即，对于下面的代码

```javascript
var name = "Bob"
let user = {
    name: "Mike",
    getName: function () {
        console.log(this.name)
    }
}

user.getName()
```

`this`指向的是当前调用者`user`，此时控制台输出

```console
Mike
```

而当我们给输出的方法加入定时器后

```javascript
var name = "Bob"
let user = {
    name: "Mike",
    getName: function () {
        console.log(this.name)
    }
}

user.getName()
```

此时，定时器中的`this`指向的是全局环境，浏览器中指`window`，控制台输出的`this.name`也就是`window.name`，即

```console
Bob
```

如果想要解决这个问题，可以

```javascript
var name = "Bob"
let user = {
    name: "Mike",
    getName: function () {
        let that = this
        console.log(that.name)
    }
}

user.getName()
```

控制台输出

```console
Mike
```

定时器可以取消

```javascript
let timer = setTimeout(function () {
    console.log("大家好")
}, 3000)

// 取消定时器
clearTimeout(timer)
```

执行代码后无论过多久控制台都不会打印定时器`timer`中的内容。

### `setInterval()`

`setInterval()`函数的用法与`setTimeout()`完全一致，区别在于`setInerval()`是指定某个人物每间隔一段时间就执行一次，也就是无限次的定时执行。

```javascript
let timer = setInterval(function () {
    console.log("大家好")
}, 1000)
```

上述代码执行后控制台每隔一秒会打印一次

```console
大家好
```

通过`setInterval()`方法可以实现简单的网页动画效果。

```html
<style>
    #cartoon {
        width: 100px;
        height: 100px;
        background-color: red;
        opacity: 1;
    }
</style>

<script>
    let div = document.getElementById("cartoon")
    let opacity = 1
    let flag = 1

    function fadeIn() {
        let fadeIn = setInterval(function () {
            if (opacity > 0 && flag === 1) {
                opacity -= 0.05
                div.style.opacity = opacity
            } else {
                flag = 0
                clearInterval(fade1)
                fadeOut()
            }
        }, 60)
    }

    function fadeOut() {
        let fadeOut = setInterval(function () {
            if (opacity <= 1 && flag === 0) {
                opacity += 0.05
                div.style.opacity = opacity
            } else {
                flag = 1
                clearInterval(fade2)
                fadeIn()
            }
        }, 60)
    }

    fadeIn()
</script>
```

网页输出一个红色的方块不停淡入淡出的动画。
